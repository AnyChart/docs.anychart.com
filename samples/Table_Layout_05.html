<!DOCTYPE html>
<html>
<head>
    <meta name="ac:name" content="Table Layout 05"/>
    <meta name="ac:short-desc" content=""/>
    <meta name="ac:desc" content=""/>
    <script src="https://cdn.anychart.com/js/7.3.0/anychart-bundle.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="https://cdn.anychart.com/css/7.3.0/anychart-ui.min.css" />
    
    <style>
        html, body, #container {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div id="container"></div>
<script>
anychart.onDocumentReady(function() {

  // region data
  // columns are: ['System', 'Month', 'Availability']
  var SARawData = [
    ['Network', Date.UTC(2013, 10), 98.6],
    ['Network', Date.UTC(2013, 11), 98.5],
    ['Network', Date.UTC(2014, 0), 98.5],
    ['Network', Date.UTC(2014, 1), 99.0],
    ['Network', Date.UTC(2014, 2), 99.2],
    ['Network', Date.UTC(2014, 3), 99.0],
    ['Network', Date.UTC(2014, 4), 99.3],
    ['Network', Date.UTC(2014, 5), 99.1],
    ['Network', Date.UTC(2014, 6), 99.0],
    ['Network', Date.UTC(2014, 7), 99.3],
    ['Network', Date.UTC(2014, 8), 99.5],
    ['Network', Date.UTC(2014, 9), 99.7],
    ['ERP', Date.UTC(2013, 10), 98.6],
    ['ERP', Date.UTC(2013, 11), 98.9],
    ['ERP', Date.UTC(2014, 0), 98.8],
    ['ERP', Date.UTC(2014, 1), 98.3],
    ['ERP', Date.UTC(2014, 2), 98.6],
    ['ERP', Date.UTC(2014, 3), 98.7],
    ['ERP', Date.UTC(2014, 4), 98.9],
    ['ERP', Date.UTC(2014, 5), 98.3],
    ['ERP', Date.UTC(2014, 6), 98.1],
    ['ERP', Date.UTC(2014, 7), 99.0],
    ['ERP', Date.UTC(2014, 8), 98.9],
    ['ERP', Date.UTC(2014, 9), 99.3],
    ['Data Warehouse', Date.UTC(2013, 10), 95.3],
    ['Data Warehouse', Date.UTC(2013, 11), 95.9],
    ['Data Warehouse', Date.UTC(2014, 0), 96.7],
    ['Data Warehouse', Date.UTC(2014, 1), 95.6],
    ['Data Warehouse', Date.UTC(2014, 2), 96.8],
    ['Data Warehouse', Date.UTC(2014, 3), 95.8],
    ['Data Warehouse', Date.UTC(2014, 4), 96.3],
    ['Data Warehouse', Date.UTC(2014, 5), 95.6],
    ['Data Warehouse', Date.UTC(2014, 6), 95.4],
    ['Data Warehouse', Date.UTC(2014, 7), 95.5],
    ['Data Warehouse', Date.UTC(2014, 8), 96.7],
    ['Data Warehouse', Date.UTC(2014, 9), 96.9],
    ['Web Site', Date.UTC(2013, 10), 97.9],
    ['Web Site', Date.UTC(2013, 11), 98.4],
    ['Web Site', Date.UTC(2014, 0), 98.5],
    ['Web Site', Date.UTC(2014, 1), 98.8],
    ['Web Site', Date.UTC(2014, 2), 99.0],
    ['Web Site', Date.UTC(2014, 3), 99.3],
    ['Web Site', Date.UTC(2014, 4), 99.2],
    ['Web Site', Date.UTC(2014, 5), 99.4],
    ['Web Site', Date.UTC(2014, 6), 99.4],
    ['Web Site', Date.UTC(2014, 7), 99.5],
    ['Web Site', Date.UTC(2014, 8), 99.6],
    ['Web Site', Date.UTC(2014, 9), 99.7],
    ['Email', Date.UTC(2013, 10), 99.0],
    ['Email', Date.UTC(2013, 11), 98.4],
    ['Email', Date.UTC(2014, 0), 99.1],
    ['Email', Date.UTC(2014, 1), 98.2],
    ['Email', Date .UTC(2014, 2), 98.2],
    ['Email', Date.UTC(2014, 3), 97.9],
    ['Email', Date.UTC(2014, 4), 98.6],
    ['Email', Date.UTC(2014, 5), 99.1],
    ['Email', Date.UTC(2014, 6), 98.4],
    ['Email', Date.UTC(2014, 7), 99.2],
    ['Email', Date.UTC(2014, 8), 99.2],
    ['Email', Date.UTC(2014, 9), 99.3],
    ['HR', Date.UTC(2013, 10), 97.0],
    ['HR', Date.UTC(2013, 11), 97.9],
    ['HR', Date.UTC(2014, 0), 98.2],
    ['HR', Date.UTC(2014, 1), 98.9],
    ['HR', Date.UTC(2014, 2), 98.2],
    ['HR', Date.UTC(2014, 3), 98.7],
    ['HR', Date.UTC(2014, 4), 98.4],
    ['HR', Date.UTC(2014, 5), 98.5],
    ['HR', Date.UTC(2014, 6), 98.6],
    ['HR', Date.UTC(2014, 7), 98.5],
    ['HR', Date.UTC(2014, 8), 98.7],
    ['HR', Date.UTC(2014, 9), 98.8],
    ['Problem Tracking', Date.UTC(2013, 10), 96.1],
    ['Problem Tracking', Date.UTC(2013, 11), 96.1],
    ['Problem Tracking', Date.UTC(2014, 0), 96.0],
    ['Problem Tracking', Date.UTC(2014, 1), 95.9],
    ['Problem Tracking', Date.UTC(2014, 2), 95.7],
    ['Problem Tracking', Date.UTC(2014, 3), 95.5],
    ['Problem Tracking', Date.UTC(2014, 4), 95.0],
    ['Problem Tracking', Date.UTC(2014, 5), 94.9],
    ['Problem Tracking', Date.UTC(2014, 6), 94.8],
    ['Problem Tracking', Date.UTC(2014, 7), 95.0],
    ['Problem Tracking', Date.UTC(2014, 8), 94.8],
    ['Problem Tracking', Date.UTC(2014, 9), 94.4]
  ];
  var SAAcceptedAvailability = {
    'Network': 99,
    'ERP': 98,
    'Data Warehouse': 98,
    'Web Site': 98,
    'Email': 98,
    'HR': 96,
    'Problem Tracking': 93
  };

  var Today = '2014/10/15';
  // endregion

  // region utility methods to ease up some routines
  /**
   * Utility function to setup property to a whole row.
   * @param {anychart.ui.Table} table Table to setup row for.
   * @param {number} rowIndex Row index.
   * @param {!Array.<string>|string} propNameOrChain Property name to access, like 'border' or chain of property names
   *    to access, e.g. ['content', 'fontSize']. Note: no checking on valid results is done, so it's up to you to
   *    ensure property existence.
   * @param {*|Array.<*>} propValueOrArray Value to set.
   */
  function setupRowProp(table, rowIndex, propNameOrChain, propValueOrArray) {
    if (rowIndex >= table.rowsCount()) return;
    if (typeof propNameOrChain == 'string') propNameOrChain = [propNameOrChain];
    var chainLastIndex = propNameOrChain.length - 1;
    for (var i = 0; i < table.colsCount(); i++) {
      var prop = table.getCell(rowIndex, i);
      for (var j = 0; j < chainLastIndex; j++) {
        prop = prop[propNameOrChain[j]]();
        if (!prop) break;
      }
      if (!prop) continue;
      if (typeof propValueOrArray != 'string' && typeof propValueOrArray.length == 'number')
        prop[propNameOrChain[chainLastIndex]].apply(prop, propValueOrArray);
      else
        prop[propNameOrChain[chainLastIndex]](propValueOrArray);
    }
  }

  /**
   * Utility function to setup property to a whole column.
   * @param {anychart.ui.Table} table Table to setup row for.
   * @param {number} colIndex Row index.
   * @param {!Array.<string>|string} propNameOrChain Property name to access, like 'border' or chain of property names
   *    to access, e.g. ['content', 'fontSize']. Note: no checking on valid results is done, so it's up to you to
   *    ensure property existence.
   * @param {*|Array.<*>} propValueOrArray Value to set.
   * @param {boolean=} opt_skipFirstRow Set true to skip first row.
   */
  function setupColProp(table, colIndex, propNameOrChain, propValueOrArray, opt_skipFirstRow) {
    if (colIndex >= table.colsCount()) return;
    if (typeof propNameOrChain == 'string') propNameOrChain = [propNameOrChain];
    var chainLastIndex = propNameOrChain.length - 1;
    for (var i = opt_skipFirstRow ? 1 : 0; i < table.rowsCount(); i++) {
      var prop = table.getCell(i, colIndex);
      for (var j = 0; j < chainLastIndex; j++) {
        prop = prop[propNameOrChain[j]]();
        if (!prop) break;
      }
      if (!prop) continue;
      if (typeof propValueOrArray != 'string' && typeof propValueOrArray.length == 'number')
        prop[propNameOrChain[chainLastIndex]].apply(prop, propValueOrArray);
      else
        prop[propNameOrChain[chainLastIndex]](propValueOrArray);
    }
  }

  /**
   * Utility function to calculate the sum of field values over a view.
   * @param {anychart.data.View} view
   * @param {string} fieldName
   * @return {number}
   */
  function calcSum(view, fieldName) {
    // calculating average
    var sum = 0;
    var count = 0;
    // we iterate over the view and sum up the field value
    var iter = view.getIterator();
    while (iter.advance()) {
      count++;
      sum += iter.get(fieldName);
    }
    return sum;
  }

  /**
   * Utility function to calculate the average value of the field over a view.
   * @param {anychart.data.View} view
   * @param {string} fieldName
   * @return {number}
   */
  function calcAvg(view, fieldName) {
    return calcSum(view, fieldName) / view.getIterator().getRowsCount();
  }

  /**
   * Creates a small tight date time scale (no gaps at all outside of the range).
   * @return {anychart.scales.DateTime}
   */
  function createTightDTScale() {
    // removing gaps and ticks to make the line fill the horizontal space of the cell
    return anychart.scales.dateTime()
        .minimumGap(0)
        .maximumGap(0)
        .ticks([]);
  }

  /**
   * Short way to add thousand separators to the number.
   * @param {number} value
   * @param {number=} opt_decimalDigits
   * @return {string}
   */
  function formatNumber(value, opt_decimalDigits) {
    return value.toFixed(opt_decimalDigits || 2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
  }

  function formatDate(value) {
    var m = value.getMonth() + 1;
    if (m < 10) m = '0' + m;
    var d = value.getDate();
    if (d < 10) d = '0' + d;
    var y = value.getFullYear() - 2000;
    return m + '/' + d + '/' + y;
  }

  /**
   * Returns difference between two dates in days. Result is positive, if date2 is later than date1.
   * @param {Date} date1
   * @param {Date} date2
   * @return {number}
   */
  function getDiffInDays(date1, date2) {
    function isLeapYear(year) {
      // Leap year logic; the 4-100-400 rule
      return year % 4 == 0 && (year % 100 != 0 || year % 400 == 0);
    }
    function getNumberOfDaysInMonth(year, month) {
      switch (month) {
        case 1:
          return isLeapYear(year) ? 29 : 28;
        case 3:
        case 5:
        case 8:
        case 10:
          return 30;
      }
      return 31;
    }
    function getNumberOfDaysInYear(year) {
      return isLeapYear(year) ? 366 : 365;
    }
    var sign = 1;
    if (date1.getTime() > date2.getTime()) {
      var tmp = date1;
      date1 = date2;
      date2 = tmp;
      sign = -1;
    }
    var y1 = date1.getUTCFullYear();
    var y2 = date2.getUTCFullYear();
    var m1 = date1.getUTCMonth();
    var m2 = date2.getUTCMonth();
    var d1 = date1.getUTCDate();
    var d2 = date2.getUTCDate();
    var res = 0, i;
    if (y1 < y2) {
      for (i = y1 + 1; i < y2; i++)
        res += getNumberOfDaysInYear(i);
      for (i = m1 + 1; i < 12; i++)
        res += getNumberOfDaysInMonth(y1, i);
      for (i = 0; i < m2; i++)
        res += getNumberOfDaysInMonth(y2, i);
      res += getNumberOfDaysInMonth(y1, m1) - d1;
      res += d2;
    } else if (m1 < m2) {
      for (i = m1 + 1; i < m2; i++)
        res += getNumberOfDaysInMonth(y1, i);
      res += getNumberOfDaysInMonth(y1, m1) - d1;
      res += d2;
    } else {
      res += d2 - d1;
    }
    return res * sign;
  }
  // endregion

  anychart.fontFamily = 'verdana, helvetica, arial, sans-serif';

  function formSAReport(rawData, acceptedAvail) {
    // we are not going to need different mapping on the raw data, so we map it at the same time
    // we use 'System' and 'Availability' fields in our calculations and 'x' and 'value' fields are used by the charts.
    var rawView = anychart.data.set(rawData).mapAs({'System': [0], 'Availability': [2], 'x': [1], 'value': [2]});

    // we need this to create filtering functions
    function filterBySystem(system) {
      return function(value) {
        return system == value;
      }
    }

    // we use common scales for charts in columns to make them comparable
    var bulletScale = anychart.scales.linear();
    // settings manual minimum and maximum to show the range we need.
    bulletScale.minimum(85).maximum(100);

    var lineScale = createTightDTScale();


    // preparing report data
    var contents = [['Last 12 Month', 'System', 'Availability %', null]];
    // forming a row for each system
    for (var system in acceptedAvail) {
      var row = [];

      // preparing data for the row
      var systemData = rawView.filter('System', filterBySystem(system));
      var avgAvail = calcAvg(systemData, 'Availability');

      // we will need one line chart per system
      // we don't need any other chart elements besides the chart line, so we can use line series directly here.
      var line = anychart.cartesian.series.line(systemData);
      // we set come line properties to make it look better and also we set the common x scale
      line.stroke('2 #000');
      line.tooltip().contentFormatter(function(e){
        var d = new Date(e.x);
        var options = {
          year: 'numeric',
          month: 'long'
        };
        var transformedDate =  d.toLocaleDateString('en-US', options);
        return transformedDate;
      });
      line.xScale(lineScale);


      // we will also need one bullet chart per system
      var bullet = anychart.bullet([{'value': avgAvail, 'type': 'line', gap: 0.4}]);
      bullet.range(0).from(acceptedAvail[system]).to(100).fill('#ccc');
      bullet.scale(bulletScale);
      bullet.title().enabled(false);
      bullet.axis().enabled(false);
      bullet.background().enabled(true).stroke('#ccc').fill('#fff');
      bullet.padding(0);
      bullet.margin(0);

      row[0] = line;
      row[1] = system;
      row[2] = bullet;
      row[3] = avgAvail.toFixed(1) + '%';
      contents.push(row);
    }

    var container = anychart.graphics.layer();
    var titleHeight = 20;
    var tableHeight = (contents.length - 1) * 24 + 20;
    var reportBounds = anychart.math.rect(0, 0, 600, tableHeight + titleHeight);

    var table = anychart.ui.table();
    table.contents(contents);
    table.rowHeight(0, 20);
    table.rowHeight(8, 30);
    table.colWidth(3, 60);
    table.colWidth(1, 160);

    table.cellBorder('2 #555555 0.5');
    table.cellTextFactory()
        .padding(0)
        .vAlign('center')
        .hAlign('left')
        .fontWeight(600)
        .fontSize(13)
        .fontColor('red');

    setupRowProp(table, 0, ['content', 'vAlign'], 'bottom');
    setupRowProp(table, 0, ['padding', 'bottom'], 2);
    setupColProp(table, 2, 'padding', [10], true);
    setupColProp(table, 3, ['content', 'hAlign'], 'left', true);
    table.getCell(0, 2).colSpan(2).content().hAlign('right');
    table.container(stage);

    table.draw();
    return {
      'report': container,
      'bounds': reportBounds
    };
  }




  stage = anychart.graphics.create('container');
  stage.suspend();

  var titleHeight = 40;

  var title1 = anychart.ui.title();


  var formattedToday = (new Date(Today)).toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric'});

  var leftColumnReports = [
    formSAReport(SARawData, SAAcceptedAvailability),
  ];

  var top = 0;
  var left = 10;
  var width = 0;
  var report, bounds, i;
  for (i = 0; i < leftColumnReports.length; i++) {
    report = leftColumnReports[i]['report'];
    bounds = leftColumnReports[i]['bounds'];
    // stage.rect(left, top, bounds.width, bounds.height);
    report.parent(stage);
    report.translate(left, top);
    top += bounds.height;
    width = Math.max(width, bounds.width);
  }

  stage.resume();
});
</script>
</body>
</html>