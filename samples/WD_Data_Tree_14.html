<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <meta name="ac:name" content="WD Data Tree 14"/>
    <meta name="ac:short-desc" content=""/>
    <meta name="ac:desc" content=""/>
    
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-base.min.js"></script>
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-treemap.min.js"></script>
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-exports.min.js"></script>
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-ui.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="https://cdn.anychart.com/releases/RC-8.2.1/css/anychart-ui.min.css" />
    
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        textarea {
            position: absolute;
            width: 100%;
            height: 30%;
            left: 0;
            border-left: none;
            resize: none;
            top: 40px;
            font-family: Courier New;
        }
        button {
            margin: 10px 0 10px 10px;
            visibility: visible;
        }
        .container {
            position: absolute;
            width: 100%;
            height: 60%;
            bottom: 0;
        }
    </style>
</head>
<body>
<button id = "searchButton" onclick="searchAndRender()">Search & Render</button>
<textarea id="log"></textarea>
<div id="container_1" class="container"></div>
<div id="container_2" class="container"></div>
<script>
anychart.onDocumentReady(function () {

    // create a chart
    chart_1 = anychart.treeMap();

    // set the chart title
    chart_1.title("Tree Data Model: Indexes");

    // set the container id
    chart_1.container("container_1");

    // initiate drawing the chart
    chart_1.draw();
});

// a comparison function
function comparisonFunction(fieldValue, comparisonValue) {
  return fieldValue < comparisonValue;
};

// search for items and render the chart
function searchAndRender(){

  var start = performance.now();
  var data = getData(50000);
  var treeData = anychart.data.tree(data, "as-tree");
  log("Generating data and creating a tree.", start);

  start = performance.now();
  treeData.createIndexOn("value");
  log("Creating an index on the 'value' field.", start);

  start = performance.now();
  var indexResult = treeData.searchItems("value", 99950, comparisonFunction);
  log("Searching on the indexed field. Result: " +
      indexResult.length + " items > 99950.", start);

  start = performance.now();
  treeData.removeIndexOn("value");
  var notIndexResult = treeData.searchItems("value", 99950, comparisonFunction);
  log("Removing the index and searching. Result: " +
      notIndexResult.length + " items > 99950.", start);

  start = performance.now();
  var newChildArray = [];
  for (var i = 1; i < indexResult.length; i++){
    var newChildObj = {};
    newChildObj.name = indexResult[i].get("name");
    newChildObj.value = indexResult[i].get("value");
    newChildArray.push(newChildObj);
  };
  var newData = [{name: "Root", children: newChildArray}];
  chart_1.enabled(false);
  var chart_2 = anychart.treeMap(newData);
  chart_2.labels().format("{%name}");
  chart_2.title("Tree Data Model: Indexes");
  chart_2.container("container_2");
  chart_2.draw();
  log("Showing the found items on a chart", start);

  // hide the button
  document.getElementById("searchButton").style.visibility = "hidden";
};

// a function for generating data
function getData(n){
  // generate data
  var childArray = [];
  for (var i = 1; i < n; i++){
    var childObj = {};
    var randomValue = Math.floor((Math.random() * 99999) + 1);
    childObj.name = "Child " + i;
    childObj.value = randomValue;
    childArray.push(childObj);
  };
  var data = [{name: "Root", children: childArray}];
  return data;
};

// a function for adding text to the text area
function log(text, start) {
  var area = document.getElementById("log");
  area.value = area.value + "[" + (performance.now() - start).toFixed(2) +
                            " ms]: " + text + "\n";
};
</script>
</body>
</html>