<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <meta name="ac:name" content="WD Data Tree 14"/>
    <meta name="ac:short-desc" content=""/>
    <meta name="ac:desc" content=""/>
    
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-base.min.js"></script>
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-treemap.min.js"></script>
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-exports.min.js"></script>
    <script src="https://cdn.anychart.com/releases/RC-8.2.1/js/anychart-ui.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="https://cdn.anychart.com/releases/RC-8.2.1/css/anychart-ui.min.css" />
    
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        button {
            margin: 10px 0 10px 10px;
        }
        #log {
            position: absolute;
            width: 100%;
            height: 30%;
            top: 40px;
            margin: 0 0 0 7px;
            font-family: Courier New;
            font-size: 14px;
        }
        #container {
            position: absolute;
            width: 100%;
            height: 55%;
            bottom: 0;
        }
    </style>
</head>
<body>
<button id = "searchButton" onclick="searchAndRender()">Search & Render</button>
<div id="log"></div>
<div id="container"></div>
<script>
anychart.onDocumentReady(function () {

    // create a chart
    chart = anychart.treeMap();

    // set the chart title
    chart.title("Tree Data Model: Indexes");

    // set the container id
    chart.container("container");

    // initiate drawing the chart
    chart.draw();
});

// a comparison function
function comparisonFunction(fieldValue, comparisonValue) {
  return fieldValue < comparisonValue;
};

// search for items and render the chart
function searchAndRender(){

  // clear the log
  document.getElementById("log").innerHTML = "";

  var start = performance.now();
  var generatedData = getData(50000);
  var treeData = anychart.data.tree(generatedData, "as-tree");
  log("Generating data and creating a tree.", start);

  start = performance.now();
  treeData.createIndexOn("value", false, comparisonFunction);
  log("Creating an index on the 'value' field.", start);

  start = performance.now();
  var indexResult = treeData.searchItems("value", 99950, comparisonFunction);
  log("Searching on the indexed field. Result: " +
      indexResult.length + " items > 99950.", start);
  
  start = performance.now();
  treeData.removeIndexOn("value");
  var notIndexResult = treeData.searchItems("value", 99950, comparisonFunction);
  log("Removing the index and searching. Result: " +
      notIndexResult.length + " items > 99950.", start);
  
  start = performance.now();
  var newChildArray = [];
  for (var i = 1; i < notIndexResult.length; i++){
    var newChildObj = {};
    newChildObj.name = notIndexResult[i].get("name");
    newChildObj.value = notIndexResult[i].get("value");
    newChildArray.push(newChildObj);
  };
  var newData = [{name: "Root", children: newChildArray}];
  chart.data(newData);
  chart.labels().format("{%name}");
  chart.title("Tree Data Model: Indexes");
  log("Showing the found items on a chart.", start);

};

// a function for generating data
function getData(n){
  // generate data
  var childArray = [];
  for (var i = 1; i < n; i++){
    var childObj = {};
    var randomValue = Math.floor((Math.random() * 99999) + 1);
    childObj.name = "Child " + i;
    childObj.value = randomValue;
    childArray.push(childObj);
  };
  var data = [{name: "Root", children: childArray}];
  return data;
};

// a function for adding text to the log
function log(text, start) {
  var logText = document.getElementById("log");
  logText.innerHTML = logText.innerHTML +
                      "[" + (performance.now() - start).toFixed(2) +
                      " ms]: " + text + "<br>";
};
</script>
</body>
</html>