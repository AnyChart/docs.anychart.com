<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="ac:name" content="CS Interactivity 18"/>
<meta name="ac:short-desc" content=""/>
<meta name="ac:desc" content=""/>

<script src="https://cdn.anychart.com/releases/DVF-3692-table/js/anychart-base.min.js"></script>
<script src="https://cdn.anychart.com/releases/DVF-3692-table/js/anychart-exports.min.js"></script>
<script src="https://cdn.anychart.com/releases/DVF-3692-table/js/anychart-ui.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.anychart.com/releases/DVF-3692-table/css/anychart-ui.min.css" />

<style>
html, body, #container {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}
.custom-tooltip {
  position: absolute;
  pointer-events: none;
  visibility: visible;
  display: none;
  border: 1px solid #d8d8d8;
  height: 150px;
  width: 320px;
}
</style>
</head>
<body>
<div id="container"></div>
<div class='custom-tooltip' id='tooltip'></div>
<script>
anychart.onDocumentReady(function () {
  var tooltip = document.getElementById("tooltip");

  // data
  var data = anychart.data.set([
    ["2000", 10048, 2600, 3200, 2159, 2089],
    ["2001", 10938, 2367, 1989, 2383, 4199],
    ["2002", 9989, 2156, 2399, 2867, 2567],
    ["2003", 10226, 2398, 2225, 3010, 2593],
    ["2004", 11004, 2851, 3007, 2805, 2341],
    ["2005", 10934, 3400, 2105, 2563, 2866],
    ["2006", 11275, 2878, 2933, 3561, 1903],
    ["2007", 11945, 2959, 3855, 3109, 2022],
    ["2008", 12245, 4001, 2156, 3928, 2160],
    ["2009", 12056, 1995, 2057, 4902, 3102],
    ["2010", 11734, 2584, 3166, 3101, 2883],
    ["2011", 12337, 3106, 2845, 2933, 3453],
    ["2012", 12761, 3296, 2655, 3144, 3666],
    ["2013", 13390, 2611, 4194, 3206, 3379],
    ["2014", 13818, 3000, 2599, 4107, 4112],
    ["2015", 13188, 3199, 2564, 3118, 4307]
  ]);

  // map data for the each series
  var dataMapping = data.mapAs({x: 0, value: 1});

  // chart type
  var chart = anychart.column();

  // set data
  var column = chart.column(dataMapping);
  // disable default tooltip
  column.tooltip(false);

  // chart title
  chart.title("Sales volume");

  // disable select mode
  chart.interactivity().selectionMode("none");

  barChart = createTooltipChart();

  // event for mouse over a column
  chart.listen("pointMouseOver", function (e) {
    // display hidden tooltip
    tooltip.style.display = "block";
    var index = e.pointIndex;

    var dataRow = data.row(index);
    // set new data for tooltip chart
    barChart.data([
      {x: "John", value: dataRow[2]},
      {x: "James", value: dataRow[3]},
      {x: "Peter", value: dataRow[4]},
      {x: "Mattew", value: dataRow[5]}
    ]);
    var titleText = "Sales Persons Share: ";
    // adjust title
    barChart.title(titleText + dataRow[0]);
  });

  // event for mouse leaving column
  chart.listen("pointMouseOut", function () {
    tooltip.style.display = "none";
  });

  // adjust tooltip position on mouse move
  chart.listen("mouseMove", function (e) {
    // get chart container elements
    var container = this.container().getStage().container();
    // get offsets
    var rect = container.getBoundingClientRect();
    offset = {
        top: rect.top + document.body.scrollTop,
        left: rect.left + document.body.scrollLeft
    };

    var clientX = e['clientX'] - offset['left'];
    var clientY = e['clientY'] - offset['top'];

    // prevent tooltip from leaving the screen    
    var left = (clientX - 10) - tooltip.offsetWidth / 2;
    if (left + tooltip.offsetWidth > chart.container().width())
      left = chart.container().width() - 2 - tooltip.offsetWidth;
    if (left < 0)
      left = 0;

    // get mouse position and move tooltip
    tooltip.style.left = left + "px";
    tooltip.style.top = clientY - 10 - tooltip.offsetHeight + "px";
  });

  // draw main chart
  chart.container("container");
  chart.draw();
});

// create tooltip chart and adjust settings
function createTooltipChart() {

  var barChart = anychart.bar();
  
  // configure axes and labels
  barChart.xAxis().stroke(null).ticks(false);
  barChart.xAxis().labels().fontSize(10);
  barChart.yAxis().labels().fontSize(10);
  // adjust title
  var barTitle = barChart.title();
  barTitle.enabled(true);
  barTitle.fontSize(12);
  // set padding
  barChart.padding([0, 12, 0, 0]);
  // set tooltip container
  barChart.container("tooltip");
  // draw tooltip chart
  barChart.draw();
  
  return barChart;
}
</script>
</body>
</html>